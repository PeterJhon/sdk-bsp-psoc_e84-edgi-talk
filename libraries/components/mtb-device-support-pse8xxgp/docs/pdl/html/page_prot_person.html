<!-- HTML header for doxygen 1.8.13-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MTB Peripheral Driver Library (PDL): Introducing Protection Personalities</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen_style.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><a href="http://www.cypress.com/"><img alt="Logo" src="IFXCYP_one-line.png"/></a></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MTB Peripheral Driver Library (PDL)</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('page_prot_person.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Introducing Protection Personalities </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1>SAU (Security Attribution Units)</h1>
<p >The Security Attribution Units (SAU) personality allows you to configure SAU security settings for device memory:</p>
<div class="image">
<img src="sau_personality.png" alt=""/>
<div class="caption">
SAU personality</div></div>
 <p >After enabling a region and adding 'Base Address' and 'End Address' for a particular SAU region, you will need to configure if that memory is ‘Non-Secure’ or ‘Non-Secure Callable’.</p>
<p >By default, all memory is ‘Secure’; and non-secure code can not access it or call functions stored in this memory. By configuring the memory to be ‘Non-Secure Callable’, it grants non-secure code permission to only call and execute functions stored in this memory. Configuring memory to be ‘Non-Secure’ grants non-secure code permission to read and/or modify this memory and in addition to executing code.</p>
<p >The SAU personality is available in Secure cores. After configuring region(s), when saved, the Device Configurator generates a file ‘cycfg_sau.h’ with the function Cy_SauInit(void) for SAU configuration. This function has to be called from the secure core main() function.</p>
<h1>MPU (Memory Protection Units)</h1>
<p >The Memory Protection Units (MPU) personality is available for each core:</p>
<div class="image">
<img src="mpu_personality.png" alt=""/>
<div class="caption">
MPU personality</div></div>
 <p >Each MPU has 8 regions that can be created and configured.</p>
<p >After enabling a MPU region, the ‘Base Address’ and ‘End Address’ should be configured. After that, there are a few options for region security:</p><ul>
<li>'Privileged Access only' – if marked, only privileged code (supervisor) can access this region.</li>
<li>‘Writable’ – configures if this memory can be written to. If not set – this region is read-only.</li>
<li>‘Executable’ – specifies if the code stored in this region can be executed.</li>
<li>‘Device Memory’: – sets either whether this memory is device peripherals or not. If not set, next options are available:<ul>
<li>‘Non-Cacheable’: This option disables caching for the memory region. Every read or write to this region is directly sent to the memory or peripheral without involving the cache. Non-cacheable memory is often used for memory-mapped I/O (e.g., peripheral registers) where caching can cause stale data or delayed writes.</li>
<li>Note: The ‘Cacheable’ parameter is used to indicate to the hardware that the data in an MPU region might be cached, not necessarily that it is cached. Selecting an option other than ‘Non-Cacheable’ for a memory region that is inherently non-cacheable, such as the ITCM/DTCM memory regions, will be treated as if the Non-Cacheable option is the selected option.</li>
<li>‘Write-Back Non-Transient’: In write-back caching, data writes are first stored in the cache. The data is written back to the main memory only when necessary (e.g., when the cache block is replaced). The term non-transient indicates that this cache line is expected to remain valid over time and isn’t just for temporary use. In write-back caching, data writes are first stored in the cache. The data is written back to the main memory only when necessary (e.g., when the cache block is replaced). The term non-transient indicates that this cache line is expected to remain valid over time and isn’t just for temporary use.</li>
<li>‘Write-Back Transient’: Similar to write-back non-transient, but this option is intended for data that is only expected to be in the cache for a short time (i.e., transient data). The cached data is written back to memory only when necessary. This option is suitable for temporary data or buffers that are not frequently reused and can be safely evicted from the cache.</li>
<li>‘Write-Through Non-Transient’: In write-through caching, every write to the cache is immediately mirrored (written through) to the main memory. Non-transient indicates that the data will remain relevant over time. This is useful when you need to ensure that memory always has the most up-to-date data, but still want to take advantage of cache reads. This setting is typically used for important data that should not be lost even if the cache is flushed.</li>
<li>‘Write-Through Transient’: As with write-through non-transient, every write operation is immediately reflected in the main memory. The transient part suggests that this data is temporary and is likely to be replaced soon. This is typically used for short-lived data, where you want to ensure consistency between the cache and memory but expect the data to be replaced or discarded soon.</li>
</ul>
</li>
<li><p class="startli">If set, next options are available:</p><ul>
<li>‘Device-nGnRnE’: No Gathering, No Reordering, No Early Acknowledgment. This is the strictest option, ensuring that memory accesses happen exactly as issued, with no optimizations. This is ideal for device memory where the timing and order of transactions are critical.</li>
<li>‘Device-nGnRE’: No Gathering, No Reordering, Early Acknowledgment. Early write acknowledgment is allowed, meaning the processor can continue executing after writing to the device memory without waiting for the write to complete. This can be beneficial for performance but may not be suitable for all devices.</li>
<li>‘Device-nGRE’: No Gathering, Reordering allowed, Early Acknowledgment. This allows for reordering and early acknowledgment, which may improve performance but sacrifices the strict control over memory access order and timing that is usually needed for device memory.</li>
<li>‘Device-GRE’: Gathering, Reordering, Early Acknowledgment. This is the most relaxed setting, allowing the processor to optimize memory transactions heavily. This is generally not suitable for most device memory interactions where precise control over access is needed. </li>
</ul>
<p class="startli">After saving, the settings will be generated to cycfg_mpu_cm33_s_0.c file for secure MPU or cycfg_mpu_cm33_ns_0.c/ cycfg_mpu_cm55_ns_0.c for non-secure cores in GeneratedSource folder.</p>
<p class="startli">To apply then call Cy_MpuInit_cm33_ns_0()/Cy_MpuInit_cm55_ns_0()/Cy_MpuInit_cm33_s_0() function. </p><h1>MPC</h1>
<p class="startli">The Memory Protection Controllers (MPC) personality allows you to configure MPC security settings for device memory: </p><div class="image">
<img src="mpc_personality.png" alt=""/>
<div class="caption">
MPC personality</div></div>
<p> You can configure MPC settings for each memory block that are in the device and integrated to the Memory Configurator. </p><div class="image">
<img src="mpc_memories.png" alt=""/>
</div>
<p> To protect any available memory, enable MPC of the memory that is in question (SRAM 0 in this example). Select any free Memory Protection slot: </p><div class="image">
<img src="mpc_protection_settings.png" alt=""/>
</div>
<p> Then, configure it by selecting if each Protection Context should read and/or write to the region, and if this region should be accessible by secure code only: </p><div class="image">
<img src="mpc_pc_settings.png" alt=""/>
</div>
<p> Once done, open the Memory tab of the Device Configurator and add a new or edit an existing memory region in memory that was selected before: </p><div class="image">
<img src="mpc_region_settings.png" alt=""/>
</div>
 <div class="image">
<img src="mpc_memory_region.png" alt=""/>
</div>
<p> In the Settings list, select the "Memory Protection" that was enabled and configured in the previous step, and click OK. It will prompt you to save if not saved before. </p><div class="image">
<img src="mpc_region_settings_selection.png" alt=""/>
</div>
<p> Once done, go back to the SRAM 0 MPC configuration: </p><div class="image">
<img src="mpc_access_response.png" alt=""/>
</div>
<p> Region 0 was created with Start Offset and End Offset filled in with offsets specified for that particular block. Also, the Security Settings option has been set selected. The personality has only one editable parameter: Invalid Access Response. It configures what should happen if any access occurs from the code in improper Protection Context or, for example, if the code attempts to write to the memory that was marked as read only. The MPC can either ignore that or cause a Bus Error. This will cause a generation array of MPC structures and MPC parameters to be generated and can be applied from secure core only: </p><div class="fragment"><div class="line"><span class="keywordflow">for</span> (uint8_t i = 0U; i &lt; mxsramc_0_mpc_0_REGION_NUMBER; i++)</div>
<div class="line">{</div>
<div class="line">    (void)<a class="code hl_function" href="group__group__mpc__functions.html#ga3b0bd2e97a05a45124a9b65ae2d6ed23">Cy_Mpc_ConfigRotMpcStruct</a>(RAMC0_MPC0, &amp;mxsramc_0_mpc_0_config[i]);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">(void)<a class="code hl_function" href="group__group__mpc__functions.html#gaa45ea4cabe4cd5feb9aab552929ae70c">Cy_Mpc_SetViolationResponse</a>(RAMC0_MPC0, mxsramc_0_mpc_0_RESPONCE);</div>
<div class="ttc" id="agroup__group__mpc__functions_html_ga3b0bd2e97a05a45124a9b65ae2d6ed23"><div class="ttname"><a href="group__group__mpc__functions.html#ga3b0bd2e97a05a45124a9b65ae2d6ed23">Cy_Mpc_ConfigRotMpcStruct</a></div><div class="ttdeci">cy_en_mpc_status_t Cy_Mpc_ConfigRotMpcStruct(MPC_Type *base, const cy_stc_mpc_rot_cfg_t *rotConfig)</div><div class="ttdoc">Initializes the referenced mpc by setting the PC, NS/S and RW/R/W permissions.</div><div class="ttdef"><b>Definition:</b> cy_mpc.c:141</div></div>
<div class="ttc" id="agroup__group__mpc__functions_html_gaa45ea4cabe4cd5feb9aab552929ae70c"><div class="ttname"><a href="group__group__mpc__functions.html#gaa45ea4cabe4cd5feb9aab552929ae70c">Cy_Mpc_SetViolationResponse</a></div><div class="ttdeci">cy_en_mpc_status_t Cy_Mpc_SetViolationResponse(MPC_Type *base, bool mpcResponse)</div><div class="ttdoc">Set MPC Violation Response.</div><div class="ttdef"><b>Definition:</b> cy_mpc.c:712</div></div>
</div><!-- fragment --><p> The list of MPC configuration structures is located in cycfg_memory.c file in the GeneratedSource folder with cycfg_memory.h containing #defines. For every MPC region, there are 8 configuration structures generated for every Protection Context. </p>
</li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part
<div id="nav-path" class="navpath">
    <ul>
        <li class="footer">
            Generated for <b>MTB Peripheral Driver Library (PDL)</b> by <b>Cypress Semiconductor Corporation</b>.
            All rights reserved.
        </li>
    </ul>
</div>
-->
</body>
</html>
