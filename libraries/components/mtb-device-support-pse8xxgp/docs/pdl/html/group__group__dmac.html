<!-- HTML header for doxygen 1.8.13-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MTB Peripheral Driver Library (PDL): DMAC         (Direct Memory Access Controller)</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen_style.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><a href="http://www.cypress.com/"><img alt="Logo" src="IFXCYP_one-line.png"/></a></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MTB Peripheral Driver Library (PDL)</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('group__group__dmac.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#groups">API Reference</a>  </div>
  <div class="headertitle"><div class="title">DMAC (Direct Memory Access Controller)</div></div>
</div><!--header-->
<div class="contents">
<a name="details" id="details"></a><h2 class="groupheader">General Description</h2>
<p >Configures the DMA Controller block, channels and descriptors. </p>
<p >The functions and other declarations used in this driver are in cy_dmac.h. You can include cy_pdl.h to get access to all functions and declarations in the PDL.</p>
<p >The DMA Controller channel can be used in any project to transfer data without CPU intervention basing on a hardware trigger signal from another component.</p>
<p >The DMA Controller block has a set of registers, a base hardware address, and supports multiple channels. Many API functions for the DMAC driver require a base hardware address and channel number. Ensure that you use the correct hardware address for the DMA Controller block in use.</p>
<p >Features:</p><ul>
<li>Multiple channels (device specific).</li>
<li>Four priority levels for each channel.</li>
<li>Descriptor chaining.</li>
<li>Configurable data transfer width/masking: byte, half-word (2-byte), and word (4-byte).</li>
<li>Configurable source and destination addresses.</li>
<li>Single transfer, 1D, 2D, memory copy and scatter transfer descriptor types are supported.</li>
<li>Configurable input/output triggers and interrupts.</li>
</ul>
<h1><a class="anchor" id="group_dmac_configuration"></a>
Configuration Considerations</h1>
<p >To set up a DMAC driver, initialize a descriptor, initialize and enable a channel, and enable the DMAC block.</p>
<p >To set up a descriptor, provide the configuration parameters for the descriptor in the cy_stc_dmac_descriptor_config_t structure. Then call the Cy_DMAC_Descriptor_Init function to initialize the descriptor in SRAM. You can modify the source and destination addresses dynamically by calling Cy_DMAC_Descriptor_SetSrcAddress and Cy_DMAC_Descriptor_SetDstAddress.</p>
<p >To set up a DMAC channel, provide a filled cy_stc_dmac_channel_config_t structure. Call the Cy_DMAC_Channel_Init function, specifying the channel number. Use Cy_DMAC_Channel_Enable to enable the configured DMAC channel.</p>
<p >Call Cy_DMAC_Channel_Enable for each DMAC channel in use.</p>
<p >When configured, another peripheral typically triggers the DMAC channel. The trigger is connected to the DMAC channel using the trigger multiplexer. The trigger multiplexer driver has a software trigger you can use in firmware to trigger the DMAC channel. See the <a href="group__group__trigmux.html">Trigger Multiplexer</a> documentation.</p>
<p >The following is a simplified structure of the DMAC driver API interdependencies in a typical user application: </p><div class="image">
<img src="dmac.png" alt=""/>
</div>
<p ><b>NOTE:</b> DMAC will read descriptors from SRAM memory. To run DMAC on devices with Core CM7, D cache needs to be cleaned before calling Cy_DMAC_Channel_Enable and should be invalidated after DMAC transfer. <br  />
<b>NOTE:</b> Even if a DMAC channel is enabled, it is not operational until the DMAC block is enabled using function Cy_DMAC_Enable.<br  />
 <b>NOTE:</b> If the DMAC descriptor is configured to generate an interrupt, the interrupt must be enabled using the Cy_DMAC_Channel_SetInterruptMask function for each DMAC channel.</p>
<p >For example: </p><div class="fragment"><div class="line"><span class="preprocessor">    #define DATA_COUNT (8UL)</span></div>
<div class="line">    <span class="comment">/* Scenario: Initialize a 1D descriptor */</span></div>
<div class="line">    cy_stc_dmac_descriptor_t descriptor;</div>
<div class="line">    cy_stc_dmac_descriptor_t nextDescriptor;</div>
<div class="line">    uint32_t src[DATA_COUNT];</div>
<div class="line">    uint32_t dst[DATA_COUNT];</div>
<div class="line">    </div>
<div class="line">    cy_stc_dmac_descriptor_config_t descriptor_cfg = </div>
<div class="line">    {</div>
<div class="line">        .retrigger = CY_DMAC_RETRIG_IM,</div>
<div class="line">        .interruptType = CY_DMAC_DESCR,</div>
<div class="line">        .triggerOutType = CY_DMAC_DESCR,</div>
<div class="line">        .channelState = CY_DMAC_CHANNEL_ENABLED,</div>
<div class="line">        .triggerInType = CY_DMAC_DESCR,</div>
<div class="line">        .dataSize = CY_DMAC_WORD,</div>
<div class="line">        .srcTransferSize = CY_DMAC_TRANSFER_SIZE_WORD,</div>
<div class="line">        .dstTransferSize = CY_DMAC_TRANSFER_SIZE_WORD,</div>
<div class="line">        .descriptorType = CY_DMAC_1D_TRANSFER,</div>
<div class="line">        .srcAddress = &amp;src,</div>
<div class="line">        .dstAddress = &amp;dst,</div>
<div class="line">        .srcXincrement = 1U,</div>
<div class="line">        .dstXincrement = 1U,</div>
<div class="line">        .xCount = DATA_COUNT,</div>
<div class="line">        .srcYincrement = 0U,</div>
<div class="line">        .dstYincrement = 0U,</div>
<div class="line">        .yCount = 1UL,</div>
<div class="line">        .nextDescriptor = &amp;nextDescriptor,</div>
<div class="line">    };</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">if</span> (CY_DMAC_SUCCESS != Cy_DMAC_Descriptor_Init(&amp;descriptor, &amp;descriptor_cfg))</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">/* Insert error handling */</span></div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="comment">/* Scenario: Setup and enable the DMAC channel 0 */</span></div>
<div class="line">    cy_stc_dmac_channel_config_t channelConfig;</div>
<div class="line">    channelConfig.enable = <span class="keyword">false</span>;</div>
<div class="line">    channelConfig.bufferable = <span class="keyword">false</span>;</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">if</span> (CY_DMAC_SUCCESS != Cy_DMAC_Channel_Init(DMAC, 0UL, &amp;channelConfig))</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">/* Insert error handling */</span></div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    Cy_DMAC_Channel_SetDescriptor(DMAC, 0UL, &amp;descriptor);</div>
<div class="line">    Cy_DMAC_Channel_SetPriority(DMAC, 0UL, 3UL);</div>
<div class="line">    Cy_DMAC_Channel_Enable(DMAC, 0UL);</div>
<div class="line">    </div>
<div class="line">    Cy_DMAC_Enable(DMAC);</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">if</span> (<span class="keyword">true</span> != Cy_DMAC_Channel_IsEnabled(DMAC, 0UL))</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">/* Insert error handling */</span></div>
<div class="line">    }</div>
<div class="line"> </div>
</div><!-- fragment --><p >CM7 cores support Data Cache. Data Cache line is 32 bytes. User needs to make sure that the source and destination buffer pointers and the config structure pointers passed to the following functions points to 32 byte aligned data. Cy_DMAC_Channel_SetDescriptor, Cy_DMAC_Descriptor_SetNextDescriptor, Cy_DMAC_Descriptor_SetSrcAddress, Cy_DMAC_Descriptor_SetDstAddress. User can use CY_ALIGN(32) macro for 32 byte alignment. User needs to clean the following data elements from the cache and invalidate before accessing them. source and destination buffers and descriptor structure.</p><ul>
<li><div class="fragment"><div class="line">    uint32_t i;</div>
<div class="line">     <span class="keywordflow">for</span>(i = 0; i &lt; DATACNT; i++)</div>
<div class="line">    {</div>
<div class="line">        dstData[i] = 0;</div>
<div class="line">        srcData[i] = i;</div>
<div class="line"> </div>
<div class="line">    }</div>
<div class="line">    Cy_DMAC_Descriptor_Init(&amp;Descriptor_0, &amp;Descriptor_0_config);</div>
<div class="line">    Cy_DMAC_Descriptor_SetSrcAddress(&amp;Descriptor_0, srcData);</div>
<div class="line">    Cy_DMAC_Descriptor_SetDstAddress(&amp;Descriptor_0, dstData);</div>
<div class="line">    Cy_DMAC_Channel_Init(DMAC, 0U, &amp;channelConfig);</div>
<div class="line">    Cy_DMAC_Enable(DMAC);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#if (CY_CPU_CORTEX_M7) &amp;&amp; defined (ENABLE_CM7_DATA_CACHE)</span></div>
<div class="line">    SCB_CleanDCache_by_Addr((uint32_t*)srcData, DATACNT);</div>
<div class="line">    SCB_CleanDCache_by_Addr((uint32_t*)&amp;Descriptor_0, <span class="keyword">sizeof</span>(Descriptor_0));</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">    Cy_DMAC_Channel_Enable(DMAC, 0U);</div>
<div class="line"><span class="preprocessor">#if defined(KIT_XMC7200) || defined(KIT_XMC7100)</span></div>
<div class="line">    <a class="code hl_function" href="group__group__trigmux.html#ga882218319ecd105dede8b382e9a1c4a4">Cy_TrigMux_SwTrigger</a>(TRIG_OUT_MUX_3_MDMA_TR_IN0, <a class="code hl_define" href="group__group__trigmux__macros.html#ga9347a341f6903dee749841fae0dcb4a5">CY_TRIGGER_TWO_CYCLES</a>);</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line">    <a class="code hl_function" href="group__group__trigmux.html#ga882218319ecd105dede8b382e9a1c4a4">Cy_TrigMux_SwTrigger</a>(TRIG_OUT_MUX_6_MDMA_TR_IN0, <a class="code hl_define" href="group__group__trigmux__macros.html#ga9347a341f6903dee749841fae0dcb4a5">CY_TRIGGER_TWO_CYCLES</a>);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">    <span class="keywordflow">while</span>(!Cy_DMAC_Channel_GetInterruptStatus(DMAC,0U))</div>
<div class="line">    {</div>
<div class="line"> </div>
<div class="line">    }</div>
<div class="line"><span class="preprocessor">#if (CY_CPU_CORTEX_M7) &amp;&amp; defined (ENABLE_CM7_DATA_CACHE)</span></div>
<div class="line">    SCB_InvalidateDCache_by_Addr ((uint32_t*)dstData, DATACNT);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">    int32_t cmpRes = memcmp(srcData, dstData, DATACNT);</div>
<div class="line">    <span class="keywordflow">if</span> (cmpRes !=0)</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">/* Insert error handling */</span></div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">    {</div>
<div class="line">        <span class="comment">/* working case */</span></div>
<div class="line">    }</div>
<div class="ttc" id="agroup__group__trigmux__macros_html_ga9347a341f6903dee749841fae0dcb4a5"><div class="ttname"><a href="group__group__trigmux__macros.html#ga9347a341f6903dee749841fae0dcb4a5">CY_TRIGGER_TWO_CYCLES</a></div><div class="ttdeci">#define CY_TRIGGER_TWO_CYCLES</div><div class="ttdoc">The only valid cycles number value for PERI_ver2.</div><div class="ttdef"><b>Definition:</b> cy_trigmux.h:251</div></div>
<div class="ttc" id="agroup__group__trigmux_html_ga882218319ecd105dede8b382e9a1c4a4"><div class="ttname"><a href="group__group__trigmux.html#ga882218319ecd105dede8b382e9a1c4a4">Cy_TrigMux_SwTrigger</a></div><div class="ttdeci">__STATIC_INLINE cy_en_trigmux_status_t Cy_TrigMux_SwTrigger(uint32_t trigLine, uint32_t cycles)</div><div class="ttdoc">This function generates a software trigger on an input trigger line.</div><div class="ttdef"><b>Definition:</b> cy_trigmux.h:398</div></div>
</div><!-- fragment --></li>
</ul>
<h1><a class="anchor" id="group_dmac_more_information"></a>
More Information.</h1>
<p >See the DMAC chapter of the device technical reference manual (TRM).</p>
<h1><a class="anchor" id="group_dmac_changelog"></a>
Changelog</h1>
<table class="doxtable">
<tr>
<th>Version</th><th>Changes</th><th>Reason for Change </th></tr>
<tr>
<td>1.40 </td><td>Added new API Cy_DMAC_Channel_IsEnabled. </td><td>New devices support.  </td></tr>
<tr>
<td>1.30.1 </td><td>Minor Documentation update for cache usage on CM7. </td><td>Documentation enhancement.  </td></tr>
<tr>
<td>1.30 </td><td>Update to configure DMAC on core CM7. </td><td>Support for new product family.  </td></tr>
<tr>
<td>1.20 </td><td>Fixed MISRA 2012 violations. </td><td>MISRA 2012 compliance.  </td></tr>
<tr>
<td>1.10.1 </td><td>Minor documentation updates. </td><td>Documentation enhancement.  </td></tr>
<tr>
<td>1.10 </td><td>The Cy_DMAC_Channel_ClearInterrupt is changed. </td><td>Minor defect fixing.  </td></tr>
<tr>
<td>1.0 </td><td>The initial version. </td><td></td></tr>
</table>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="groups" name="groups"></a>
API Reference</h2></td></tr>
<tr class="memitem:group__group__dmac__macros"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__group__dmac__macros.html">Macros</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:group__group__dmac__macros__interrupt__masks"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__group__dmac__macros__interrupt__masks.html">Interrupt Masks</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:group__group__dmac__functions"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__group__dmac__functions.html">Functions</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:group__group__dmac__data__structures"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__group__dmac__data__structures.html">Data Structures</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:group__group__dmac__enums"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__group__dmac__enums.html">Enumerated Types</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part
<div id="nav-path" class="navpath">
    <ul>
        <li class="footer">
            Generated for <b>MTB Peripheral Driver Library (PDL)</b> by <b>Cypress Semiconductor Corporation</b>.
            All rights reserved.
        </li>
    </ul>
</div>
-->
</body>
</html>
