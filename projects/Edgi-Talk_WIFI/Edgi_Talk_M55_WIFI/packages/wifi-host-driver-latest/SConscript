Import('RTT_ROOT')
Import('rtconfig')
from building import *

cwd = GetCurrentDir()

# add the general drivers.
src = Split("""
    wifi-host-driver/WHD/COMPONENT_WIFI6/resources/resource_imp/whd_resources.c
    wifi-host-driver/WHD/COMPONENT_WIFI6/src/bus_protocols/whd_bus.c
    wifi-host-driver/WHD/COMPONENT_WIFI6/src/bus_protocols/whd_bus_common.c
    wifi-host-driver/WHD/COMPONENT_WIFI6/src/bus_protocols/whd_bus_sdio_protocol.c
""")


# add wifi host driver source and header files
src += Glob('wifi-host-driver/WHD/COMPONENT_WIFI6/src/*.c')

path = [cwd + '/wifi-host-driver']
path += [
        cwd + "/wifi-host-driver/WHD/COMPONENT_WIFI6/inc",
        cwd + "/wifi-host-driver/WHD/COMPONENT_WIFI6",
        cwd + "/wifi-host-driver/WHD/COMPONENT_WIFI6/resources/clm/COMPONENT_43012",
        cwd + "/wifi-host-driver/WHD/COMPONENT_WIFI6/resources/clm",
        cwd + "/wifi-host-driver/WHD/COMPONENT_WIFI6/resources",
        cwd + "/wifi-host-driver/WHD/COMPONENT_WIFI6/resources/firmware/COMPONENT_43012",
        cwd + "/wifi-host-driver/WHD/COMPONENT_WIFI6/resources/firmware",
        cwd + "/wifi-host-driver/WHD/COMPONENT_WIFI6/resources/nvram/COMPONENT_43012/COMPONENT_MURATA-1LV",
        cwd + "/wifi-host-driver/WHD/COMPONENT_WIFI6/resources/nvram/COMPONENT_43012",
        cwd + "/wifi-host-driver/WHD/COMPONENT_WIFI6/resources/nvram",
        cwd + "/wifi-host-driver/WHD/COMPONENT_WIFI6/resources/resource_imp",
        cwd + "/wifi-host-driver/WHD/COMPONENT_WIFI6/src/bus_protocols",
        cwd + "/wifi-host-driver/WHD/COMPONENT_WIFI6/src",
        cwd + "/wifi-host-driver/WHD/COMPONENT_WIFI6/src/include"]

# add whd porting source files
src += Glob('porting/src/bsp/*.c')
# src += Glob('porting/src/rtos/*.c')
src += Glob('porting/src/wlan/*.c')

path += [cwd + '/porting/inc/bsp']
# path += [cwd + '/porting/inc/hal']
# path += [cwd + '/porting/inc/rtos']


src += ["wifi-connection-manager/source/COMPONENT_55500/cy_chip_constants.h",
        "wifi-connection-manager/source/cy_wcm.c"]
path += [cwd + "/wifi-connection-manager/include",
         cwd + "/wifi-connection-manager/source/COMPONENT_55500/"]


path += [cwd + "/connectivity-utilities",
        cwd + "/connectivity-utilities/network",]


src += [
    # "whd-bsp-integration/COMPONENT_LWIP/cy_network_buffer_lwip.c",
        "whd-bsp-integration/cybsp_wifi.c"]
path += [cwd + "/whd-bsp-integration"]


src += ["lwip-network-interface-integration/source/cy_network_mw_core.c",
        # "lwip-network-interface-integration/source/cy_lwip_dhcp_server.c",
        # "lwip-network-interface-integration/source/cy_ethernetif.c",
        ]
path += [cwd + "/lwip-network-interface-integration/include",
         cwd + "/lwip-network-interface-integration/source"]

CPPDEFINES = [
        "COMPONENT_SDIO_HM",
        "BLHS_SUPPORT",
        "COMPONENT_55500",
        "COMPONENT_55500A1",
        "COMPONENT_CYW55513_MOD_PSE84_SOM",
        "COMPONENT_HCI_UART",
        "COMPONENT_MW_BT_FW_IFX_CYW55500A1",
        "COMPONENT_SM",
        "COMPONENT_WIFI_INTERFACE_SDIO",
        "WIFI_INTERFACE_SDIO",
        "COMPONENT_wlbga_iPA_sLNA_ANT0_LHL_XTAL_IN",
        "CYBSP_WIFI_WL_HOSTWAKE_DRIVE_MODE=MTB_HAL_GPIO_DRIVE_OPENDRAINDRIVESLOW",
        "CYBSP_WIFI_WL_HOSTWAKE_INIT_STATE=WHD_TRUE",
        "CY_WIFI_COUNTRY=WHD_COUNTRY_UNITED_STATES",
        "TRXV5",
        "CYBSP_HOST_WAKE_IRQ_EVENT=CYHAL_GPIO_IRQ_FALL"
]

group = DefineGroup('whd', src, depend = ['BSP_USING_WIFI_HOST_DRIVER'], CPPPATH = path, CPPDEFINES = CPPDEFINES)

Return('group')
